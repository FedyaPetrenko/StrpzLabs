services:
  consumer:
    build:
      context: C:\Projects\Strpz Labs\StrpzLabs
      dockerfile: KafkaListener/Dockerfile
    depends_on:
    - kibana
    - webapi
    environment:
      KAFKA_BOOTSTRAP-SERVERS: kafka:9092
    image: consumer
  kafka:
    depends_on:
    - zookeeper
    environment:
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092
      KAFKA_CREATE_TOPICS: orders:1:1
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
    image: wurstmeister/kafka
    ports:
    - published: 9092
      target: 9092
  kibana:
    image: nshou/elasticsearch-kibana
    ports:
    - published: 9200
      target: 9200
    - published: 5601
      target: 5601
  redis:
    container_name: cache
    expose:
    - 6379
    image: redis
  sql:
    environment:
      ACCEPT_EULA: "Y"
      SA_PASSWORD: SimplePass123
    image: microsoft/mssql-server-linux
    ports:
    - published: 1433
      target: 1433
  webapi:
    build:
      context: C:\Projects\Strpz Labs\StrpzLabs
      dockerfile: WebApi/Dockerfile
    depends_on:
    - kafka
    - kibana
    - redis
    environment:
      KAFKA_BOOTSTRAP-SERVERS: kafka:9092
    image: webapi
    ports:
    - published: 50987
      target: 80
    - published: 44337
      target: 443
    volumes:
    - C:\Users\petre\AppData\Roaming\Microsoft\UserSecrets:/root/.microsoft/usersecrets:ro
    - C:\Users\petre\AppData\Roaming\ASP.NET\Https:/root/.aspnet/https:ro
  zookeeper:
    image: wurstmeister/zookeeper
    ports:
    - published: 8080
      target: 2181
version: '3.4'